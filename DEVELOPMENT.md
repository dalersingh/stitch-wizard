# Stitch Wizard – Development Guide

Welcome to the **Stitch Wizard** contributor handbook.  
This document describes everything you need to know to work on the package **without bloating the production distribution**.

---

## 1 . Why the Package Stays Lean in Production

The published package contains only:

* PHP source (`src/`), Blade views (`resources/views/`), routes, config and migrations.
* Composer metadata.

Everything else—Docker files, demo apps, Playwright assets, screenshots, etc.—is **ignored via `.gitignore`** and therefore never shipped to Packagist or included when a user runs `composer require stitch-wizard/stitch-wizard`.

Benefits:

* `composer install` remains fast (no Node modules, no large images).
* The installed size is tiny, leading to **quicker CI pipelines** and smaller Docker images for downstream projects.
* No unexpected binaries or dev-only scripts end up on production servers.

---

## 2 . Boot-strapping E2E Testing Locally

The repo includes a **single tracked script**:  

```
dev/setup-e2e.js
```

Running it creates everything you need for browser-level testing **outside the tracked tree**:

```bash
# one-time on a fresh clone
node dev/setup-e2e.js    # generates dev/ scripts + test-results/ folders
npm install              # installs Playwright + Express locally
```

The script will:

1. Generate `dev/` helpers (`capture-wizard-screenshots.js`, `run-e2e-tests.js`, etc.).
2. Create a minimal `package.json` with Playwright + Express as *dev* dependencies.
3. Ensure `test-results/` and its `screenshots/` sub-folder exist.
4. Append missing ignore rules to `.gitignore` so nothing created by the script becomes tracked accidentally.

---

## 3 . Running Tests & Capturing Screenshots

After boot-strap you have two npm commands:

| Command | What it does |
|---------|--------------|
| `npm run screenshots` | Spins up a tiny Express server that renders the real-estate wizard, drives it with Playwright, and saves step-by-step screenshots to `test-results/screenshots/`. |
| `npm run e2e` | Currently an alias that runs the same screenshot workflow and outputs a short console report. Extend this to add assertions or CI reporting as desired. |

Output artefacts:

* **PNG files**: `01-step1-property-details.png` … `06-final-100-percent.png`
* **Markdown report**: `e2e-test-summary.md` with inline images and notes on each fix.

All artefacts live under `test-results/` (git-ignored).

---

## 4 . Fixes Implemented

The following issues were identified and are **fixed and covered by the screenshots**:

| # | Area | Description | Proof |
|---|------|-------------|-------|
| 1 | Progress bar | `floor()` → `round()` so progress reaches **100 %** on final step. | See `05-step5-confirmation.png` (bar=100 %). |
| 2 | Empty sections | Resolver skips sections with no visible fields. | `03-step3-features.png` shows no blank headings. |
| 3 | Step index usage | Replaced ad-hoc array access with `stepIndex()` helper everywhere. | Sequence of screenshots matches config order, no off-by-one. |
| 4 | Blade duplication | Extracted `resources/views/wizard/field.blade.php` partial; DRY templates. | Internal code diff. |
| 5 | PHPStan config | Removed invalid `checkMissingIterableValueType` option; analysis passes. | `phpstan-after.png` in legacy proof folder. |

---

## 5 . Development Best Practices

1. **Keep It Out of the Package**  
   • Any new tooling, large fixtures or screenshots belong in `dev/` or `test-results/` and **must be git-ignored**.  
   • Add an exception only for small bootstrap scripts similar to `setup-e2e.js`.

2. **Composer Remains the Source of Truth**  
   • Do not add Node/NPM artefacts to release tarballs.  
   • Validate with `composer validate --strict` before every tag.

3. **Document Your Workflow**  
   • Update this `DEVELOPMENT.md` when you change the E2E process or add new dev dependencies.

4. **Write Tests Close to the Feature**  
   • Unit and feature tests live in `tests/` (PHP).  
   • Browser/E2E tests are generated by the bootstrap script and should remain outside the package.

5. **Be Conscious of Package Size**  
   • Check the install footprint with `composer info -s stitch-wizard/*` or `du -sh vendor/stitch-wizard/*`.

6. **One Commit, One Concern**  
   • Fixes go in separate commits from dev-tooling updates to simplify future cherry-picks.

---

## 6 . Need Help?

1. **Run the wizard locally**  
   ```
   php artisan vendor:publish --tag=stitch-wizard-config
   php artisan migrate
   php artisan serve
   ```

2. **Questions / Issues**: Open a GitHub Discussion or Issue referencing the commit hash.

Happy hacking!  
*– Stitch Wizard Maintainers*
